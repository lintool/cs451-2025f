<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="Course homepage for CS 451/651 Data-Intensive Distributed Computing (Fall 2025) at the University of Waterloo">
    <meta name="author" content="Jimmy Lin">
    <title>CS 451/651: Data-Intensive Distributed Computing (Fall 2025)</title>

    <!-- Bootstrap core CSS -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="../css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="../js/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>

  </head>


  <body>

    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li><a href="../index.html">Overview</a></li>
            <li><a href="../organization.html">Organization</a></li>
            <li><a href="../syllabus.html">Syllabus</a></li>
            <li class="active"><a href="../assignments.html">Assignments</a></li>
            <li><a href="../software.html">Software</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">

  <div class="page-header">
    <div style="float: right"><img width="250" src="../images/waterloo_logo.png" alt="University of Waterloo logo"/></div>
    <h1>Assignments <br/><small>CS 451/651: Data-Intensive Distributed Computing (Fall 2025)</small></h1>
  </div>

  <div class="subnav">
    <ul class="nav nav-pills">
      <li><a href="assignment1.html">1</a></li>
      <li><a href="assignment2.html">2</a></li>
      <li><a href="assignment3.html">3</a></li>
      <li><a href="assignment4.html">4</a></li>
      <li><a href="assignment5.html">5</a></li>
      <li><a href="assignment6.html">6</a></li>
      <li><a href="project.html">Final Project</a></li>
    </ul>
  </div>

<h3>Assignment 2: ETL <small>due 10am September 25</small></h3>

<p>This assignment covers the entire ETL process, from the operational database to the analytical database.
We hand you a PostgreSQL dump of the operational database of a hypothetical e-commerce site, built on <a href="https://www.kaggle.com/datasets/mkechinov/ecommerce-behavior-data-from-multi-category-store">this dataset</a>.
At a high level, we ask you to:</p>

<ul>

<li>Restore the PostgreSQL dump into a local instance of PostgreSQL so that you can issue queries against a live operational database.</li>
<li>Export the tables from the operational database into CSV files.</li>
<li>Use Spark to transform the extracted data into relations conforming to a star schema that would be suitable for a data warehouse.</li>

</ul>

<p>Specifically, in the data warehouse, you will build:</p>

<ul>

<li>A number of dimension tables.</li>
<li>A central fact table linked to the dimension tables.</li>

</ul>

<h4 style="padding-top: 10px">Install PostgreSQL</h4>

<p>Your first step is to install PostgreSQL on your machine.
There are many ways to accomplish this, but you are expected to figure out how to do so yourself.
Once you have done so, use <code>pg_ctl</code> to start a PostgreSQL server on your local machine.</p>

<p>Grab the database dump <code>retail_schema_20250826.dump</code> from <a href="https://drive.google.com/drive/folders/1tTVzoBdOyj3kKebRAPm-zeJwwjnqCpdq?usp=sharing">here</a>.</p>

<p>With the dump file, you can restore the database <code>cs451</code> as follows:</p>

<pre>
dropdb --if-exists cs451
createdb cs451

pg_restore \
 -d cs451 \
 --jobs 4 --clean --if-exists \
 --no-owner --no-acl \
 retail_schema_20250826.dump
</pre>

<p>Launch the <code>psql</code> shell to connect to the <code>cs451</code> database that you've restored.
With the following command:</p>

<pre>
\dt retail.*
</pre>

<p>You will see all the tables under the schema <code>retail</code>, as follows:</p>

<pre>
cs451=# \dt retail.*
            List of relations
 Schema |     Name     | Type  |  Owner   
--------+--------------+-------+----------
 retail | brand        | table | jimmylin
 retail | category     | table | jimmylin
 retail | events       | table | jimmylin
 retail | product      | table | jimmylin
 retail | product_name | table | jimmylin
 retail | session      | table | jimmylin
 retail | user         | table | jimmylin
(7 rows)
</pre>

<p>As a sanity check, issue a simple SQL query:</p>

<pre>
cs451=# select * from retail.events limit 10;
       event_time       | event_type |              session_id              | product_id |   price   
------------------------+------------+--------------------------------------+------------+-----------
 2019-09-30 20:00:00-04 | view       | 72d76fde-8bb3-4e00-8c23-a032dfed738c |   44600062 |     35.79
 2019-09-30 20:00:00-04 | view       | 9333dfbd-b87a-4708-9857-6336556b0fcc |    3900821 |     33.20
 2019-09-30 20:00:01-04 | view       | 566511c2-e2e3-422b-b695-cf8e6e792ca8 |   17200506 |    543.10
 2019-09-30 20:00:01-04 | view       | 7c90fc70-0e80-4590-96f3-13c02c18c713 |    1307067 |    251.74
 2019-09-30 20:00:04-04 | view       | c6bd7419-2748-4c56-95b4-8cec9ff8b80d |    1004237 | 108198.00
 2019-09-30 20:00:05-04 | view       | 0d0d91c2-c9c2-4e81-90a5-86594dec0db9 |    1480613 |    908.62
 2019-09-30 20:00:08-04 | view       | 4fe811e9-91de-46da-90c3-bbd87ed3a65d |   17300353 |    380.96
 2019-09-30 20:00:08-04 | view       | 6280d577-25c8-4147-99a7-abc6048498d6 |   31500053 |     41.16
 2019-09-30 20:00:10-04 | view       | ac1cd4e5-a3ce-4224-a2d7-ff660a105880 |   28719074 |    102.71
 2019-09-30 20:00:11-04 | view       | 406c46ed-90a4-4787-a43b-59a410c1a5fb |    1004545 |    566.01
(10 rows)
</pre>

<p>If you've gotten this far, it appears that you've successfully restored the operational database!  ðŸŽ‰</p>

<h4 style="padding-top: 10px">Understand the Operational Database</h4>

<p>Take some time to understand the operational database.
There are no specific assignment questions associated with this task, but the remainder of the assignment will be a lot easier if you actually understand what you're doing...</p>

<p>A starting point would be <a href="https://www.kaggle.com/datasets/mkechinov/ecommerce-behavior-data-from-multi-category-store">the dataset</a> this assignment was built on.
For reference, these are the tables and their schemas in the PostgreSQL dump you've been given:</p>

<ul>

<li><code>user</code>: (<code>user_id</code>, <code>gender</code>, <code>birthdate</code>)</li>
<li><code>session</code>: (<code>session_id</code>, <code>user_id</code>)</li>
<li><code>product</code>: (<code>product_id</code>, <code>brand</code>, <code>category</code>, <code>product_name</code>)</li>
<li><code>product_name</code>: (<code>category</code>, <code>product_name</code>, <code>description</code>)</li>
<li><code>events</code>: (<code>event_time</code>, <code>event_type</code>, <code>session_id</code>, <code>product_id</code>, <code>price</code>)</li>
<li><code>category</code>: (<code>category</code>, <code>description</code>)</li>
<li><code>brand</code>: (<code>brand</code>, <code>description</code>)</li>

</ul>

<p>You want to understand the real-world entities that each table is modeling, the schema of each table and how they interact (i.e., primary key&mdash;foreign key relationships).
Do some exploratory data analysis, i.e., "poking around".
For example, join two tables to trace the PK/FK.
Join multiple tables to reconstruct a session: be able to identify what was purchased, by whom, for how much, etc.</p>
</p>

<h4 style="padding-top: 10px">The Actual Assignment</h4>

<p>The Jupyter notebook that contains the actual assignment is available <a href="https://github.com/lintool/cs451-2025f/blob/main/assignments/assignment2.ipynb">here</a>.

<p>Use <a href="https://classroom.github.com/a/bjdNjjIL">this link</a> to create an assignment repo for submission.
In the assignment repo, enter your answers in <code>assignment2.ipynb</code>.
Submit the assignment by committing your edits and pushing your repo (with the answers filled out in the notebook) back to origin.</p>

<p>Already stated in the <a href="../software.html">software page</a>, but worth repeating:
While the assignments are to be turned in via Jupyter notebooks, it is not necessarily the case that they are the most convenient development environment.
Different software capabilities can be accessed via JupyterLab, from a shell (terminal), from VS Code, etc.
You might want to experiment with difference approaches for different usage scenarios.</p>

<h4 style="padding-top: 10px">Grading Scheme</h4>

<ul>

  <li><code>qcell_1b76x2</code> SQL queries: 14 points total (3/3/3/5 for Q1, Q2, Q3, and Q4, respectively)</li>
  <li><code>codecell_30z8le</code> load in CSV files into DataFrames: 3 points</li>
  <li><code>codecell_41ax14</code> build <code>dim_user</code>: 5 points</li>
  <li><code>codecell_43k3n9</code> build <code>dim_brand</code>, <code>dim_category</code>, <code>dim_product</code>: 13 points (4/4/5 for each of the tables)</li>
  <li><code>codecell_44qm5c</code> build <code>dim_date</code>: 5 points</li>
  <li><code>codecell_51ep7v</code> cleaning: 6 points</li>
  <li><code>codecell_52hg6x</code> and <code>codecell_52bf5d</code> cap silly prices: 4 points</li>
  <li><code>codecell_53l2kp</code> lookup tables: 4 points</li>
  <li><code>codecell_54aaaa</code> joining everything together: 6 points</li>
  <li><code>qcell_6a9876</code> size: 3 points</li>
  <li><code>qcell_6b1234</code> answers: 8 points</li>
  <li>Explanation of how you used generative AI for this assignment: 3 points (this goes in <code>README.md</code>)</li>
  <li>Following instructions: 6 points</li>

</ul>

<p>What does "following instructions" mean? These are "free points" if you follow the instructions provided in this assignment.
These points are to handle the scenario where all your answers are correct, but you <i>did not</i> follow the instructions and that caused us to go out of our way to fix your submission so that it conforms to the instructions.
(For example, you removed the ids that we used for tracking, which would make it much more difficult to grade.)
In these and other related cases, we will dock points from this category.</p>

<p><b>Total:</b> 80 points</p>

<p style="padding-top: 20px"><a href="#">Back to top</a></p>

<div style="padding-bottom: 100px"></div>

    </div><!-- /.container -->


    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

  </body>
</html>
